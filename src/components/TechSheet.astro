---
import { withBase } from "../utils/paths";

interface Props {
  title: string;
  pdf: string;    // ex: "docs/ft-nevrosyne-5ch-2.0-3.pdf"
  thumb: string;  // ex: "docs/ft-nevrosyne-5ch-2.0-3-thumb.jpg"
}
const { title, pdf, thumb } = Astro.props;
const pdfUrl = withBase(pdf);
const thumbUrl = withBase(thumb);
---

<style>
  /* mini lightbox via <dialog> natif */
  dialog::backdrop { background: rgba(0,0,0,.6); }
  dialog {
    width: min(90vw, 1000px);
    border: 1px solid #333;
    border-radius: 12px;
    padding: 0;
    background: var(--color-ink-900, #0b0e14);
  }
</style>

<section class="rounded-xl border border-zinc-700 bg-coal-800/60 p-4">
  <h3 class="text-xl font-semibold mb-3">{title}</h3>

  <!-- Vignette cliquable -->
  <button
    class="group block w-full max-w-[300px] overflow-hidden rounded-lg border border-zinc-700"
    onclick="document.getElementById('ts-modal').showModal()"
    aria-label={`Agrandir l’aperçu de ${title}`}
  >
    <img
      src={thumbUrl}
      alt={`Aperçu de ${title}`}
      class="w-full h-auto transition-transform duration-200 group-hover:scale-[1.02]"
      loading="lazy"
      width="520"
      height="auto"
    />
  </button>

  <!-- Actions -->
  <div class="mt-3 flex flex-wrap gap-2">
    <a
      href={pdfUrl}
      target="_blank"
      rel="noopener"
      class="px-4 py-2 rounded-lg border border-zinc-700 bg-coal-800 hover:bg-coal-700"
      >Ouvrir le PDF</a
    >
    <a
      href={pdfUrl}
      download
      class="px-4 py-2 rounded-lg border border-zinc-700 bg-coal-800 hover:bg-coal-700"
      >Télécharger le PDF</a
    >
  </div>

  <!-- Modal d’agrandissement -->
  <dialog id="ts-modal">
    <div class="p-3 flex items-center justify-between border-b border-zinc-700">
      <h4 class="text-lg font-medium">{title}</h4>
      <form method="dialog">
        <button class="px-3 py-1 rounded-md border border-zinc-700 hover:bg-coal-700">Fermer</button>
      </form>
    </div>
    <div class="p-3">
      <!-- Grand aperçu (image). Si tu préfères l’aperçu PDF, remplace par <iframe> / <embed> -->
      <img src={thumbUrl} alt={`Aperçu agrandi de ${title}`} class="max-w-full h-auto rounded-md" />
      <div class="mt-3">
        <a
          href={pdfUrl}
          target="_blank"
          rel="noopener"
          class="inline-block px-4 py-2 rounded-lg border border-zinc-700 bg-coal-800 hover:bg-coal-700"
          >Ouvrir le PDF</a
        >
      </div>
    </div>
  </dialog>
</section>