---
import { withBase } from "../utils/paths";

// Le composant accepte maintenant indifféremment :
// {logo|src, name|alt, url|href}
type In = { logo?: string; src?: string; name?: string; alt?: string; url?: string; href?: string };

const rawItems = (Array.isArray(Astro.props.items) ? Astro.props.items : []) as In[];

const items = rawItems.map((it) => {
  // normalise les clés
  const logo = (it.logo ?? it.src ?? "").toString().trim();
  const name = (it.name ?? it.alt ?? "Logo").toString();
  const url  = (it.url  ?? it.href ?? "#").toString();

  // si ce n'est pas une URL absolue, on préfixe avec la base (GH Pages)
  const isExternal = /^(https?:)?\/\//i.test(logo) || /^[a-z]+:/i.test(logo);
  const src = isExternal ? logo : withBase(logo.replace(/^\//, ""));

  return { src, alt: name, href: url };
});
---

<div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
  {items.map((c) => (
    <div class="rounded-lg border border-zinc-800 bg-coal-800/40 px-3 py-4 flex items-center justify-center">
      <a href={c.href} target="_blank" rel="noopener noreferrer" aria-label={c.alt} class="w-full">
        <img
          src={c.src}
          alt={c.alt}
          loading="lazy"
          class="max-h-12 mx-auto object-contain grayscale opacity-80 hover:grayscale-0 hover:opacity-100 transition"
        />
      </a>
    </div>
  ))}
</div>